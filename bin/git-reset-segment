#! /bin/bash -eu

source /usr/share/git-hierarchy/functions.sh
GIT_DIR=$(git_dir)

mark=$GIT_DIR/.rebasing-segment

# fixme: canonize?
# check that it's a segment!
branch=$1

# not needed "ref/
base="refs/base/$branch"

# todo: use git-segment....
git-set-start $branch $base

if [ -e $mark -a x$branch = x$(cat $mark) ]; then
    rm -v $mark
else
    exit 1
fi
