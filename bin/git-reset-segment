#! /bin/bash -eu

source /usr/share/git-hierarchy/functions.sh
GIT_DIR=$(git_dir)

mark=$GIT_DIR/.rebasing-segment

usage()
{
    cat <<EOF
usage: ${0##*/} [+-h} [--] [segment]

If segment specified, that segment has its START moved to base.
If no segment is specified, the info on rebase is lost.

So, after this another rebase can start.

EOF
}

while getopts :h OPT; do
    case $OPT in
	h|+h)
	    usage
	    exit 0
	    ;;
	*)
	    usage
	    exit 2
    esac
done
shift $(( OPTIND - 1 ))
OPTIND=1

# todo: use git-segment....
git-set-start $branch $base

if [ -e $mark -a x$branch = x$(cat $mark) ]; then
    rm -v $mark
else
    exit 1
fi
